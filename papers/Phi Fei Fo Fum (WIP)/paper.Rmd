---
title: "Phi, Fei, Fo, Fum: Effect Sizes for Chi-squared Tests"

authors:
- affiliation: 1
  name: Mattan S. Ben-Shachar
  orcid: 0000-0002-4287-4801
- affiliation: 2
  name: Indrajeet Patil
  orcid: 0000-0003-1995-6531

affiliations:
- index: 1
  name: XXX
- index: 2
  name: Center for Humans and Machines, Max Planck Institute for Human Development, Berlin, Germany  


output: 
  pdf_document:
    keep_tex: true
    latex_engine: xelatex
bibliography: paper.bib
csl: apa.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(effectsize)
# options(es.use_symbols = TRUE)
```

<!-- Abstract -->

# Introduction

<!-- Blah blah blah effect sizes are important. -->

We review here the most common effect sizes for analysis of categorical variables, and introduce a new one -- $פ$ (Fei)  --alongside the `{effectsize}` package [@benshachar2020effectsize] in R programming language [@base2023], which implements these measures.

# Tests Of Independance

<!-- Should we discuss differences between effect sizes for paired versus unpaired designs?  -->

The $\chi^2$ test of independence between two categorical variables examines if the frequency distribution of one of the variables is dependent on the other. 
Formally, the test examines how likely the observed conditional frequencies (cell frequencies) are under the null hypotheses of independence.
This is done by examining the degree the observed cell frequencies deviate from the frequencies that would be expected if the variables were indeed independent. 
The test statistic for these tests is the $\chi^2$, which is computed as:

$$
\chi^2 = \sum_{i=1}^{l\times k}{\frac{(O_i-E_i)^2}{E_i}}
$$

Where $O_i$ are the *observed* frequencies and $E_i$ are the frequencies *expected* under independence, and $l$ and $k$ are the number of rows and columns of the contingency table. 

Instead of the deviations between the observed and expected frequencies, we can write $\chi^2$ in terms of observed and expected cell *probabilities* and the total sample size $N$ (since $p=k/N$):

$$
\chi^2 = N\times\sum_{i=1}^{l\times k}{\frac{(p_{O_i}-p_{E_i})^2}{p_{E_i}}}
$$

Where $p_{O_i}$ are the *observed* cell probabilities and $p_{E_i}$ are the probabilities *expected* under independence.

For example, which might ask of the probability of survival of the sinking of the Titanic is dependant on the sex of the passenger:

```{r}
(Titanic_xtab <- as.table(apply(Titanic, c(2, 4), sum)))

chisq.test(Titanic_xtab)
```

## Phi

For a 2-by-2 contingency table analysis, like the one used above, the $\phi$ (*phi*) coefficient is a correlation-like measure of effect size indicating the strength of association between the two binary variables. One way to compute this effect size is to re-code the binary variables as dummy (0,1) variables, and computing the (absolute) Pearson correlation between them:

$$
\phi = |r_{AB}|
$$

Another way to compute $\phi$ is by using the $\chi^2$ statistic:

$$
\phi = \sqrt{\frac{\chi^2}{N}} = \sqrt{\sum_{i=1}^{l\times k}{\frac{(p_{O_i}-p_{E_i})^2}{p_{E_i}}}}
$$

This value ranges between 0 (no association) and 1 (complete dependence), and its values can be interpreted the same as Person's correlation coefficient.

```{r}
library(effectsize)
library(correlation)

phi(Titanic_xtab, adjust = FALSE)

tidyr::uncount(as.data.frame(Titanic_xtab), weights = Freq) |>
  transform(Survived = Survived == "Yes",
            Sex = Sex == "Male") |> 
  correlation()
```

## Cramér's *V*

These properties do not hold when the contingency table is larger than 2-by-2: $\sqrt{\chi^2/N}$ can be larger than 1.
Cramér showed [@cramer1999mathematical] that while for 2-by-2 the maximal possible value of $\chi^2$ is $N$, for larger tables the maximal possible value for $\chi^2$ is $N\times (\text{min}(k,l)-1)$.
Therefore, he suggested the $V$ effect size (also sometimes known as Cramér's phi and denoted as $\phi_{c}$):

$$
\text{Cramer's } V = \sqrt{\frac{\chi^2}{N(\text{min}(k,l)-1)}}
$$

$V$ is 1 when the columns are completely dependent on the rows, or the row are completely dependent on the columns.

```{r}
(Titanic_xtab2 <- as.table(apply(Titanic, c(1, 4), sum)))

cramers_v(Titanic_xtab2, adjust = FALSE)
```

Tschuprow [@tschuprow1939principles] devised an alternative value, at <value>, which is 1 only when the columns are completely dependent on the rows *and* the row are completely dependent on the columns, which is only possible when the contingency table is a square.

```{r}
tschuprows_t(Titanic_xtab2)
```

We can generalize both $\phi$, $V$, and $T$ to: $\sqrt{\frac{\chi^2}{\chi^2_{\text{max}}}}$.

<!-- ## Also... -->

<!-- These can be used for confusion matrices... <!-- show that Matthew's correlation coefficient is equal to Phi. -->

# Goodness of Fit

These tests compare an observed distribution of a multinomial variable to an expected distribution, using the same $\chi^2$ statistic. Here too we can compute an effect size as $\sqrt{\frac{\chi^2}{\chi^2_{\text{max}}}}$, all we need to find is $\chi^2_{\text{max}}$.

## Cohen's *w*

Cohen [@cohen2013statistical] defined an effect size -- *w* -- for the goodness of fit test:

$$
\text{Cohen's } w = \sqrt{\sum_{i=1}^{k}{\frac{(p_{O_i}-p_{E_i})^2}{p_{E_i}}}} = \sqrt{\frac{\chi^2}{N}}
$$

Thus, $\chi^2_\text{max} = N$.

```{r}
(Titanic_freq <- as.table(apply(Titanic, 2, sum)))
p_E <- c(0.5, 0.5)

cohens_w(Titanic_freq, p = p_E)
```

Unfortunately, *w* has an upper bound of 1 *only* when the variable is binomial (has two categories) and the expected distribution is uniform ($p = 1 - p = 0.5$). If the distribution is none uniform [@rosenberg2010generalized] or if there are more than 2 classes [@johnston2006measures], then $\chi^2_\text{max} > N$, and so *w* can be larger than 1.

```{r}
O <- c(90, 10)
p_E <- c(0.35, 0.65)
cohens_w(O, p = p_E)


O <- c(10, 20, 80, 5)
p_E <- c(.25, .25, .25, .25)
cohens_w(O, p = p_E)
```

## Fei

We present here a new effect size, $פ$ (Fei) which normalizes goodness-of-fit $\chi^2$ by the proper $\chi^2_\text{max}$ for non-uniform and/or mulinomial variables.

The largest deviation from the expected probability distribution would occur when all observations are in the cell with the smallest expected probability. That is:

$$
p_{O} = 
\begin{cases}
1, & \text{if } p_i = \text{min}(p) \\
0, & \text{Otherwise}
\end{cases}
$$

Since $\chi^2 = N \times\sum_{i=1}^{k}{\frac{(p_{E_i}-p_{O_i})^2}{p_{E_i}}}$, 
we can find $\frac{(E_i-O_i)^2}{E_i}$ for each of these values:

$$
\frac{(p_{E}-p_{O})^2}{p_{E}} = 
\begin{cases}
\frac{(p_i-1)^2}{p_i}, & \text{if } p_{E} = \text{min}(p_{E}) \\
p_i = \frac{(p_i-0)^2}{p_i}, & \text{Otherwise}
\end{cases}
$$

Since $\sum_{i=1}^{k}{p_i}=1$, therefor the $\chi^2$ which is the sum of the expression above as:

$$
\begin{split}
\chi^2_\text{max} & = N \times (1 - \text{min}(p_E) + \frac{(\text{min}(p_E)-1)^2}{\text{min}(p_E)}) \\
 & = N \times \frac{1-\text{min}(p_E)}{\text{min}(p_E)} \\
 & = N \times (\frac{1}{\text{min}(p_E)} - 1)
\end{split}
$$

And so an effect size can be derived as: 

$$
\sqrt{\frac{\chi^2}{N \times (\frac{1}{\text{min}(p_E)} - 1)}}
$$

We call this effect size $פ$, which represents the voiceless bilabial fricative in the Hebrew language, keeping in line with $\phi$ (which in modern Greek marks the same sound) and $V$ (which in English mark a voiced bilabial fricative; $W$ being derived from the letter V in modern Latin alphabet). $פ$ will be 0 when the observed distribution matches the expected one perfectly, and will be 1 when the observed values are all of the same class - the one with the smallest expected probability.

```{r}
O <- c(90, 10)
p_E <- c(0.35, 0.65)
fei(O, p = p_E)


O <- c(10, 20, 80, 5)
p_E <- c(.25, .25, .25, .25)
fei(O, p = p_E)
```

When there are only 2 cells with uniform expected probabilities (50%), this expression reduces to $N$ and $פ = w$.

```{r}
O <- c(90, 10)
p_E <- c(0.5, 0.5)

fei(O, p = p_E)
cohens_w(O, p = p_E)
```

# Summary

We fill the missing effect size for all cases of a $\chi^2$ test.


# References
